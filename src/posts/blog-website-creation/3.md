---
title: 使用VuePress Theme Hope与GitHub Action部署博客项目
shortTitle: 部署博客项目
isOrigin: true
order: 4
cover: https://images.icestream32.cn/images/2024/11/09/1731087479920.jpg
category:
  - 计算机
  - 建站流程
tag:
  - Node.js
  - Npm
  - VuePress
  - 博客
  - Nginx
---

VuePress 是一个基于 Vue 的静态网站生成器，它可以帮助我们快速搭建一个博客网站。在这一章里我们将使用 VuePress Theme Hope 初始化一个博客项目，并通过 GitHub Action 自动部署到云服务器上。

<!-- more -->

## 安装 Node.js 和 Npm

具体安装步骤可以参考[Node.js 官网](https://nodejs.org/zh-cn/)，这里我使用的是 Node.js 20.18.0 版本。

按照步骤安装完成后，可以在终端输入以下命令查看版本：

```bash
node -v # 输出 V22.11.0
npm -v # 输出 10.8.2
```

## 初始化 VuePress Theme Hope 项目

右键在当前文件夹打开一个命令行，然后在`blog-test`（当然你也可以自己指定）新建 vuepress-theme-hope 项目:

```bash
npm init vuepress-theme-hope@latest blog-test
```

使用以上命令后，会出现一个命令行选择界面，关键选项如下：

- 选择语言：中文
- 打包器：Vite
- 协议：CC BY-NC-SA 4.0（博客一般都是这个知识共享协议）
- 项目类型：blog
- 初始化 Git 仓库：yes
- 初始化 GitHub Action：no （这里不需要初始化，后面会手动配置）

最后会生成一个 vuepress-theme-hope 项目，点击`blog-test`文件夹，然后右键用 VS Code 打开。

## 本地运行项目

点击 package.json 文件，会看到项目打包、运行和更新的命令。

```
"docs:build": "vuepress-vite build src" // 打包命令
"docs:clean-dev": "vuepress-vite dev src --clean-cache" // 清除缓存并运行命令
"docs:dev": "vuepress-vite dev src" // 运行命令
"docs:update-package": "npx vp-update" // 更新命令
```

运用快捷键`ctrl+v`呼出终端，在终端输入`docs:dev`命令运行项目，可以在控制台看到项目运行的地址，一般是`http://localhost:8000`，然后在浏览器中打开这个地址，就可以看到初次生成的博客页面了。

![image-20241117230241233](https://images.icestream32.cn/images/2024/11/17/image-20241117230241233.png)

## 修改 VS Code 配置

每次启动都要在终端输入`docs:dev`命令运行项目，这样很不方便，我们可以通过`lanuch.json`配置文件来实现一键启动。

在项目根目录下新建`.vscode`文件夹，然后在文件夹下新建`lanuch.json`文件，输入以下内容：

```json
{
  "version": "0.2.0",
  "configurations": [
    {
      "name": "start dev server",
      "type": "node-terminal",
      "request": "launch",
      "command": "npm run docs:dev",
      "cwd": "${workspaceFolder}"
    }
  ]
}
```

这样就可以通过 VS Code 的调试按钮一键启动项目了。

![image-20241117231621217](https://images.icestream32.cn/images/2024/11/17/image-20241117231621217.png =512x512)

## 修改 GitHub 配置

### 仓库

首先登录 GitHub，新建一个仓库，仓库名可以自己指定，进入仓库页面，点击`Code`按钮，复制仓库地址，通过以下命令，将本地项目与远程仓库关联：

```bash
git remote add origin 仓库地址
git push -u origin master
```

### Action

在项目根目录下新建`.github`文件夹，然后在文件夹下新建`workflows`文件夹，然后在文件夹下新建`deploy.yml`文件。

::: details 点击查看配置文件

```yaml
name: 部署博客页面

on:
  push: # 表示GitHub仓库的push事件时触发

permissions:
  contents: write # 表示只有在仓库内容发生变化时才触发

jobs: # 任务
  deploy-blog-pages: # 任务名
    runs-on: ubuntu-latest # 使用ubuntu系统
    steps: # 步骤
      - name: Checkout # 拉代码
        uses: actions/checkout@v4
        with:
          fetch-depth: 0
          # 如果你文档需要 Git 子模块，取消注释下一行
          # submodules: true
      - name: 设置 Node.js
        uses: actions/setup-node@v4
        with:
          node-version: 20
          cache: npm

      - name: 安装依赖
        run: |
          corepack enable
          npm ci

      - name: 构建文档
        env:
          NODE_OPTIONS: --max_old_space_size=8192
        run: |-
          npm run docs:build
          > src/.vuepress/dist/.nojekyll

      - name: 将密钥写入文件
        run: echo "${{ secrets.ALIYUN_SERVER_KEY }}" > id_ed25519 && chmod 600 id_ed25519
        shell: bash

      - name: 部署到外部服务器
        run: scp -i id_ed25519 -o "StrictHostKeyChecking=no" -r src/.vuepress/dist/* root@${{ secrets.ALIYUN_SERVER_HOST }}:/var/www/blog
```
::: important

这里介绍一下`deploy.yml`文件最后两个步骤的作用：

- 将密钥写入文件：将 GitHub 仓库的密钥写入文件，用于最后一步远程连接云服务器。

- 部署到外部服务器：
    - `scp`命令用于将本地文件复制到远程服务器。
    - `-i`参数指定私钥文件。
    - `-o "StrictHostKeyChecking=no"`参数用于跳过第一次连接时的询问。
    - `-r`参数用于递归复制文件夹。
    - `root@${{ secrets.ALIYUN_SERVER_HOST }}:/var/www/blog`表示将本地文件复制到云服务器的`/var/www/blog`目录下。

:::

接着在GitHub仓库的`Settings`->`Secrets`中添加两个密钥：

- ALIYUN_SERVER_KEY：云服务器私钥

- ALIYUN_SERVER_HOST：云服务器地址

私钥可以参照之前的文章：[配置远程连接与Nginx](./3)

最后将整个项目推送到GitHub，然后在仓库的`Actions`中查看部署情况，示例如下：

![image-20241118221735763](https://images.icestream32.cn/images/2024/11/18/image-20241118221735763.png)

## 修改 Nginx配置

此时的博客项目已经部署到云服务器上了，但是我们还需要修改 Nginx 配置文件中`location`和`error_page`的配置，将域名指向到博客项目的目录。

```nginx
location / {
    root   /var/www/blog;
    index  index.html index.htm;
}

error_page 404 /var/www/blog/404.html;
```

修改完成后，测试并重启Nginx服务：

```bash
nginx -t
nginx -s reload
```

这样就可以通过域名访问到博客项目了。

::: info

封面来源：[Pixiv](https://pixiv.net)
参考文档：

- [VuePress Theme Hope](https://theme-hope.vuejs.press/zh/guide/intro/intro.html)
- [Github Action](https://docs.github.com/cn/actions)

:::
